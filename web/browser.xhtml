<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui" 
      xmlns:c="http://java.sun.com/jsp/jstl/core">

    <f:view contentType="text/html">
        <h:head>
            <f:facet name="first">
                <link type="text/css" rel="stylesheet" href="css/browser.css"/>
                <link type="text/css" rel="stylesheet" href="css/icon.css"/>
                <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
                <title>Browser</title>
            </f:facet>
        </h:head>

        <h:body id="body">
            <f:event listener="#{BrowserController.onLoad()}" type="preRenderView" />
            <f:event listener="#{UserController.checkLogged()}" type="preRenderView" />
            <f:event listener="#{ImagesController.loadImages(BrowserController.currentFolder)}" type="preRenderView" />
            <f:event listener="#{TreeController.initAll()}" type="preRenderView" />


            <p:growl showDetail="true" sticky="false"/>

            <p:dialog header="Upload file" modal="true" id="dialogUpload" widgetVar="dlg" resizable="false" width="700px">  
                <h:form id="formUpload">  

                    <p:fileUpload fileUploadListener="#{UploadController.handleUploadFile}" 
                                  mode="advanced" dragDropSupport="true" multiple="false" oncomplete="PF('dlg').hide();"
                                  sizeLimit="16000000" update=":formFolder,:formBreadcrumb,:formTree">
                        <f:attribute name="user" value="#{UserController.user}" />
                        <f:attribute name="folder" value="#{BrowserController.currentFolder}" />

                    </p:fileUpload>  

                </h:form>  
            </p:dialog> 

            <p:dialog header="Doc Detail" widgetVar="docDialog" modal="true">  
                <p:outputPanel id="docDetail" style="text-align:center;">  
                    <h:outputText value="#{BrowserController.currentDocument.meta.name}" />
                </p:outputPanel>  
            </p:dialog>  

            <p:dialog header="Create a folder" modal="true" id="dialogCreateFolder" widgetVar="dlgCF" resizable="false" width="300px">  
                <h:form id="formCreateFolder">  
                    <h:panelGrid columns="2" style="margin-bottom:10px;width: 100%">  
                        <h:outputLabel for="name" value="Folder name" />  
                        <p:inputText id="name" required="true" value="#{BrowserController.newFolderName}" />  
                        <br/>                                            
                        <p:commandButton 
                            ajax="true" immediate="false"
                            action="#{BrowserController.createFolder()}" value="Create" 
                            update=":formFolder,:formBreadcrumb,:formTree" oncomplete="PF('dlgCF').hide();"
                        />  
                    </h:panelGrid>
                </h:form>  
            </p:dialog> 

            <p:layout fullPage="true">
                <p:layoutUnit position="north" size="42" resizable="false" closable="false" collapsible="false">
                    <h:form id="formToolbar">
                        <p:toolbar>
                            <p:toolbarGroup align="left">
                                <span class="button-group ui-widget ui-splitbutton ui-buttonset">
                                    <p:commandButton styleClass="ui-corner-left" title="Backward" icon="ui-icon-backward" ajax="true" immediate="true" update=":formFolder,:formBreadcrumb,:formTree" action="#{BrowserController.clickOnBackward}" />  
                                    <p:commandButton styleClass="ui-corner-right" title="Forward" icon="ui-icon-forward" ajax="true" immediate="true" update=":formFolder,:formBreadcrumb,:formTree" action="#{BrowserController.clickOnForward}" />
                                </span>
                                <p:separator/>
                                <span class="button-group ui-widget ui-splitbutton ui-buttonset">
                                    <p:commandButton styleClass="ui-corner-left" title="Icon View" icon="ui-icon-th-large" ajax="true" immediate="true" update=":formFolder" action="#{BrowserController.setIconView(true)}"/>  
                                    <p:commandButton title="List View" icon="ui-icon-list" ajax="true" immediate="true" update=":formFolder" action="#{BrowserController.setListView(true)}"/> 
                                    <p:commandButton styleClass="ui-corner-right" title="Gallery View" icon="ui-icon-gallery" ajax="true" immediate="true" update=":formFolder" action="#{BrowserController.setGalleriaView(true)}"/>

                                </span>
                                <p:separator/> 
                                <p:splitButton value="Upload" icon="ui-icon-upload" onclick="PF('dlg').show();
                                        return false;">
                                    <p:menuitem value="Create a folder" icon="ui-icon-plus" onclick="PF('dlgCF').show();
                                        return false;"/>
                                </p:splitButton>
                            </p:toolbarGroup>
                            <p:toolbarGroup align="center">
                                <span class="logo button-group">
                                    <img src="img/skull.png" width="29px" height="29px"/>
                                    GED of Death
                                </span>
                            </p:toolbarGroup>
                            <p:toolbarGroup align="right">
                                <p:splitButton value="#{UserController.user.login}" icon="ui-icon-user">
                                    <p:menuitem value="Logout" icon="ui-icon-closethick" action="#{UserController.logOut}" ajax="false" immediate="true"/>
                                </p:splitButton>
                            </p:toolbarGroup>
                        </p:toolbar>
                    </h:form>
                </p:layoutUnit>

                <p:layoutUnit header="Terminal" position="south" size="100" minSize="100" closable="true" collapsible="true" resizable="true" collapsed="true">
                    <p:terminal id="terminal" widgetVar="term" commandHandler="#{terminalController.handleCommand}" prompt="$"
                                welcomeMessage="Welcome to GED of Death Terminal!" />    
                </p:layoutUnit>

                <p:layoutUnit position="west" resizable="true" header="Sidebar" size="200" collapsible="true" closable="false">
                    <h:form id="formTree">  

                        <p:tree value="#{TreeController.root}" var="node" id="tree">  
                            <p:treeNode id="treeNode">  
                                <p:commandLink actionListener="#{BrowserController.clickOnFolder}" update=":formFolder,:formBreadcrumb,:formTree" value="#{node.name}">
                                    <f:param name="idFolder" value="#{node.toString()}"/>
                                </p:commandLink>
                            </p:treeNode>  
                        </p:tree>  

                    </h:form> 
                </p:layoutUnit>


                <p:layoutUnit position="center" id="browserView">
                    <div id="center-topbar">
                        <h:form id="formBreadcrumb">
                            <p:breadCrumb model="#{BrowserController.breadCrumbModel}">  
                                <p:menuitem value="Root" url="#" />
                                <p:menuitem value="Root" url="#" />
                            </p:breadCrumb>
                        </h:form> 
                    </div>
                    <div id="center-data">
                        <h:form id="formFolder" >
                            <p:dataGrid id="iconViewData" var="doc" value="#{BrowserController.toDisplay}" 
                                        columns="6" rendered="#{BrowserController.iconView}">  

                                <p:panel  style="text-align:center" styleClass="browser-element">

                                    <h:panelGrid  columns="1" style="width:100%"  onclick="PrimeFaces.ab({source: 'formFolder', update: 'formFolder formBreadcrumb', params: [{name: 'idFolder', value: '4'}]});
                                        return false;" rendered="${!doc.isFolder()}"> 
                                        <img src="img/file.png" alt="[file]" width="80px" height="80px"/>
                                        <h:outputText value="#{doc.meta.name}" />  
                                        <p:column>type : <h:outputText value="#{doc.meta.type.mimeType}" /></p:column>

                                        <p:button icon="ui-icon-search" onclick="PF('docDialog').show();
                                        return false;"/>

                                    </h:panelGrid>
                                    <h:panelGrid columns="1" style="width:100%" rendered="${doc.isFolder()}">
                                        <img src="img/folder.png" alt="[folder]" width="80px" height="80px"/>
                                        <p:commandLink actionListener="#{BrowserController.clickOnFolder}" update=":formFolder,:formBreadcrumb,:formTree" value="#{doc.folder.name}">
                                            <f:param name="idFolder" value="#{doc.folder.idFolder}"/>
                                        </p:commandLink>
                                        <div>type : folder</div>
                                    </h:panelGrid>
                                </p:panel>

                            </p:dataGrid>

                            <p:dataTable id="tbl" var="docList" value="#{BrowserController.toDisplay}" paginator="false" rendered="#{BrowserController.listView}">  
                                <p:column rendered="#{!docList.isFolder()}">  
                                    <f:facet name="header">  
                                        <h:outputText value="Name" />  
                                    </f:facet>
                                    <span class="file">
                                        <div class="icon"></div>
                                        <h:outputText value="#{docList.meta.name}" /> 
                                    </span>
                                </p:column>  

                                <p:column rendered="#{docList.isFolder()}">  
                                    <f:facet name="header">  
                                        <h:outputText value="Name" />  
                                    </f:facet>
                                    <span class="folder">
                                        <div class="icon"></div>
                                        <p:commandLink actionListener="#{BrowserController.clickOnFolder}" update=":formFolder,:formBreadcrumb,:formTree" value="#{docList.folder.name}">
                                            <f:param name="idFolder" value="#{docList.folder.idFolder}"/>
                                        </p:commandLink>
                                    </span> 
                                </p:column> 

                                <p:column exportable="false">  
                                    <f:facet name="header">  
                                        <h:outputText value="Size" />  
                                    </f:facet>  
                                    <h:outputText value="#{docList.meta.size}" rendered="#{!docList.isFolder()}"/>  
                                    <h:outputText value="-" rendered="#{docList.isFolder()}"/>  
                                </p:column>  

                                <p:column>  
                                    <f:facet name="header">  
                                        <h:outputText value="Type" />  
                                    </f:facet>  
                                    <h:outputText value="#{docList.meta.type.mimeType}" rendered="#{!docList.isFolder()}"/>  
                                    <h:outputText value="Folder" rendered="#{docList.isFolder()}"/>   
                                </p:column>  

                            </p:dataTable>

                            <h:form id="plop" rendered="#{BrowserController.galleriaView}">
                                <h:form id="no_record" rendered="#{ImagesController.listIsNull()}">
                                    <img src="img/No_record_found.png" width="300px" height="300px"/>
                                </h:form>
                                <p:galleria value="#{ImagesController.listOfID}" var="image" autoPlay="false" showCaption="true" rendered="#{!ImagesController.listIsNull()}">  
                                    <p:graphicImage value="/ImageServlet/?Image_id=#{image}" height="250" width="250"/> 
                                </p:galleria>  
                            </h:form>
                        </h:form>
                    </div>

                </p:layoutUnit>

            </p:layout>
            <script src="js/makeOnClick.js" type="text/javascript"/>
        </h:body>

    </f:view>
</html>
