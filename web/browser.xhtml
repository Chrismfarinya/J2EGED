<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui" 
      xmlns:c="http://java.sun.com/jsp/jstl/core">

    <f:view contentType="text/html">
        <h:head>
            <f:facet name="first">
                <link type="text/css" rel="stylesheet" href="css/browser.css"/>
                <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
                <title>Browser</title>
            </f:facet>
        </h:head>

        <h:body id="body">
            <f:event listener="#{BrowserController.loadDocument()}" type="preRenderView" />

            <p:growl showDetail="true" sticky="false"/>

            <p:dialog header="Upload file" modal="true" id="dialogUpload" widgetVar="dlg" resizable="false" width="700px">  
                <h:form id="form">  

                    <p:fileUpload fileUploadListener="#{UploadController.handleUploadFile}" 
                                  mode="advanced" dragDropSupport="false"  
                                  sizeLimit="100000" update="@form">
                        <f:attribute name="user" value="#{UserController.user}" />
                        <f:attribute name="folder" value="#{BrowserController.currenFolder}" />

                    </p:fileUpload>  

                </h:form>  
            </p:dialog> 

            <p:layout fullPage="true">

                <p:layoutUnit position="north" size="46" resizable="false" closable="false" collapsible="false">
                    <h:form>
                        <p:toolbar>
                            <p:toolbarGroup align="left">
                                <span class="button-group ui-widget ui-splitbutton ui-buttonset">
                                    <p:commandButton styleClass="ui-corner-left" type="button" title="Backward" icon="ui-icon-backward"/>  
                                    <p:commandButton styleClass="ui-corner-right" type="button" title="Forward" icon="ui-icon-forward"/> 
                                </span>
                                <p:separator/>
                                <span class="button-group ui-widget ui-splitbutton ui-buttonset">
                                    <p:commandButton styleClass="ui-corner-left" type="button" title="Icon View" icon="ui-icon-th-large" />  
                                    <p:commandButton styleClass="ui-corner-right" type="button" title="List View" icon="ui-icon-list"/> 
                                </span>
                                <p:separator/> 
                                <span class="button-group ui-widget ui-splitbutton ui-buttonset">
                                    <p:button styleClass="ui-corner-left" title="Upload" icon="ui-icon-upload" onclick="PF('dlg').show();
                                            return false;"  />
                                    <p:commandButton styleClass="ui-corner-right" type="button" title="Download" icon="ui-icon-download"/> 
                                </span>
                            </p:toolbarGroup>
                            <p:toolbarGroup align="right">
                                <p:inputText id="search" value="" label="Search" />  
                                <p:watermark for="search" value="Search a file" />

                                <p:splitButton value="#{UserController.user.login}" icon="ui-icon-user">
                                    <p:menuitem value="Logout" icon="ui-icon-closethick"/>
                                </p:splitButton>
                            </p:toolbarGroup>
                        </p:toolbar>
                    </h:form>
                </p:layoutUnit>

                <p:layoutUnit header="Terminal" position="south" size="100" minSize="100" closable="true" collapsible="true" resizable="true" collapsed="true">
                    <p:terminal id="terminal" widgetVar="term" commandHandler="#{terminalController.handleCommand}" prompt="$"
                                welcomeMessage="Welcome to GED of Death Terminal!" />    
                </p:layoutUnit>

                <p:layoutUnit position="west" resizable="true" header="Sidebar" size="200" collapsible="true" closable="false">
                    <h:form id="formTree">  

                        <p:tree value="#{TreeController.root}" var="node" id="tree">  
                            <p:treeNode id="treeNode">  
                                <h:outputText value="#{node}" id="lblNode"/>  
                            </p:treeNode>  
                        </p:tree>  

                    </h:form> 
                </p:layoutUnit>

                <p:layoutUnit position="center" id="browserView">
                    <h:form id="formBreadcrumb">
                        <p:breadCrumb>  
                            <p:menuitem value="Root" url="#" />
                            <p:menuitem value="Root" url="#" />
                        </p:breadCrumb>
                    </h:form> 
                    <h:form id="formFolder">
                        <p:dataGrid var="doc" value="#{BrowserController.toDisplay}" 
                                    columns="5">  

                            <p:panel style="text-align:center" styleClass="browser-element">
                                <h:panelGrid columns="1" style="width:100%" rendered="${!doc.isFolder()}" > 
                                    <img src="img/file.png" alt="[file]" width="80px" height="80px"/>
                                    <h:outputText value="#{doc.meta.name}" />  
                                    <p:column>type : <h:outputText value="#{doc.meta.type.mimeType}" /></p:column>
                                </h:panelGrid>
                                <h:panelGrid columns="1" style="width:100%" rendered="${doc.isFolder()}">
                                    <img src="img/folder.png" alt="[folder]" width="80px" height="80px"/>
                                    <p:commandLink actionListener="#{BrowserController.clickOnFolder}" update=":formFolder" value="#{doc.folder.name}">
                                        <f:param name="idFolder" value="#{doc.folder.idFolder}"/>
                                    </p:commandLink>
                                    <div>type : folder</div>
                                </h:panelGrid>
                            </p:panel>

                        </p:dataGrid>
                    </h:form>
                </p:layoutUnit>

            </p:layout>

        </h:body>

    </f:view>
</html>
